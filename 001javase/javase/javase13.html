<!doctype html>
<html>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width initial-scale=1'>
    <title>JavaSE_第13章 多线程</title>
    <link href='https://fonts.loli.net/css?family=PT+Serif:400,400italic,700,700italic&subset=latin,cyrillic-ext,cyrillic,latin-ext'
          rel='stylesheet' type='text/css'/>
    <style type='text/css'>html {
        overflow-x: initial !important;
    }

    :root {
        --bg-color: #ffffff;
        --text-color: #333333;
        --select-text-bg-color: #B5D6FC;
        --select-text-font-color: auto;
        --monospace: "Lucida Console", Consolas, "Courier", monospace;
    }

    html {
        font-size: 14px;
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
    }

    body {
        margin: 0px;
        padding: 0px;
        height: auto;
        bottom: 0px;
        top: 0px;
        left: 0px;
        right: 0px;
        font-size: 1rem;
        line-height: 1.42857;
        overflow-x: hidden;
        background: inherit;
    }

    iframe {
        margin: auto;
    }

    a.url {
        word-break: break-all;
    }

    a:active, a:hover {
        outline: 0px;
    }

    .in-text-selection, ::selection {
        text-shadow: none;
        background: var(--select-text-bg-color);
        color: var(--select-text-font-color);
    }

    #write {
        margin: 0px auto;
        height: auto;
        width: inherit;
        word-break: normal;
        word-wrap: break-word;
        position: relative;
        white-space: normal;
        overflow-x: visible;
        padding-top: 40px;
    }

    #write.first-line-indent p {
        text-indent: 2em;
    }

    #write.first-line-indent li p, #write.first-line-indent p * {
        text-indent: 0px;
    }

    #write.first-line-indent li {
        margin-left: 2em;
    }

    .for-image #write {
        padding-left: 8px;
        padding-right: 8px;
    }

    body.typora-export {
        padding-left: 30px;
        padding-right: 30px;
    }

    .typora-export .footnote-line, .typora-export li, .typora-export p {
        white-space: pre-wrap;
    }

    @media screen and (max-width: 500px) {
        body.typora-export {
            padding-left: 0px;
            padding-right: 0px;
        }

        #write {
            padding-left: 20px;
            padding-right: 20px;
        }

        .CodeMirror-sizer {
            margin-left: 0px !important;
        }

        .CodeMirror-gutters {
            display: none !important;
        }
    }

    #write li > figure:first-child {
        margin-top: -20px;
    }

    #write ol, #write ul {
        position: relative;
    }

    img {
        max-width: 100%;
        vertical-align: middle;
    }

    button, input, select, textarea {
        color: inherit;
        font-style: inherit;
        font-variant: inherit;
        font-weight: inherit;
        font-stretch: inherit;
        font-size: inherit;
        line-height: inherit;
        font-family: inherit;
    }

    input[type="checkbox"], input[type="radio"] {
        line-height: normal;
        padding: 0px;
    }

    *, ::after, ::before {
        box-sizing: border-box;
    }

    #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre {
        width: inherit;
    }

    #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p {
        position: relative;
    }

    h1, h2, h3, h4, h5, h6 {
        break-after: avoid-page;
        break-inside: avoid;
        orphans: 2;
    }

    p {
        orphans: 4;
    }

    h1 {
        font-size: 2rem;
    }

    h2 {
        font-size: 1.8rem;
    }

    h3 {
        font-size: 1.6rem;
    }

    h4 {
        font-size: 1.4rem;
    }

    h5 {
        font-size: 1.2rem;
    }

    h6 {
        font-size: 1rem;
    }

    .md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p {
        margin-top: 1rem;
        margin-bottom: 1rem;
    }

    .hidden {
        display: none;
    }

    .md-blockmeta {
        color: rgb(204, 204, 204);
        font-weight: 700;
        font-style: italic;
    }

    a {
        cursor: pointer;
    }

    sup.md-footnote {
        padding: 2px 4px;
        background-color: rgba(238, 238, 238, 0.7);
        color: rgb(85, 85, 85);
        border-radius: 4px;
        cursor: pointer;
    }

    sup.md-footnote a, sup.md-footnote a:hover {
        color: inherit;
        text-transform: inherit;
        text-decoration: inherit;
    }

    #write input[type="checkbox"] {
        cursor: pointer;
        width: inherit;
        height: inherit;
    }

    figure {
        overflow-x: auto;
        margin: 1.2em 0px;
        max-width: calc(100% + 16px);
        padding: 0px;
    }

    figure > table {
        margin: 0px !important;
    }

    tr {
        break-inside: avoid;
        break-after: auto;
    }

    thead {
        display: table-header-group;
    }

    table {
        border-collapse: collapse;
        border-spacing: 0px;
        width: 100%;
        overflow: auto;
        break-inside: auto;
        text-align: left;
    }

    table.md-table td {
        min-width: 32px;
    }

    .CodeMirror-gutters {
        border-right: 0px;
        background-color: inherit;
    }

    .CodeMirror {
        text-align: left;
    }

    .CodeMirror-placeholder {
        opacity: 0.3;
    }

    .CodeMirror pre {
        padding: 0px 4px;
    }

    .CodeMirror-lines {
        padding: 0px;
    }

    div.hr:focus {
        cursor: none;
    }

    #write pre {
        white-space: pre-wrap;
    }

    #write.fences-no-line-wrapping pre {
        white-space: pre;
    }

    #write pre.ty-contain-cm {
        white-space: normal;
    }

    .CodeMirror-gutters {
        margin-right: 4px;
    }

    .md-fences {
        font-size: 0.9rem;
        display: block;
        break-inside: avoid;
        text-align: left;
        overflow: visible;
        white-space: pre;
        background: inherit;
        position: relative !important;
    }

    .md-diagram-panel {
        width: 100%;
        margin-top: 10px;
        text-align: center;
        padding-top: 0px;
        padding-bottom: 8px;
        overflow-x: auto;
    }

    #write .md-fences.mock-cm {
        white-space: pre-wrap;
    }

    .md-fences.md-fences-with-lineno {
        padding-left: 0px;
    }

    #write.fences-no-line-wrapping .md-fences.mock-cm {
        white-space: pre;
        overflow-x: auto;
    }

    .md-fences.mock-cm.md-fences-with-lineno {
        padding-left: 8px;
    }

    .CodeMirror-line, twitterwidget {
        break-inside: avoid;
    }

    .footnotes {
        opacity: 0.8;
        font-size: 0.9rem;
        margin-top: 1em;
        margin-bottom: 1em;
    }

    .footnotes + .footnotes {
        margin-top: 0px;
    }

    .md-reset {
        margin: 0px;
        padding: 0px;
        border: 0px;
        outline: 0px;
        vertical-align: top;
        background: 0px 0px;
        text-decoration: none;
        text-shadow: none;
        float: none;
        position: static;
        width: auto;
        height: auto;
        white-space: nowrap;
        cursor: inherit;
        -webkit-tap-highlight-color: transparent;
        line-height: normal;
        font-weight: 400;
        text-align: left;
        box-sizing: content-box;
        direction: ltr;
    }

    li div {
        padding-top: 0px;
    }

    blockquote {
        margin: 1rem 0px;
    }

    li .mathjax-block, li p {
        margin: 0.5rem 0px;
    }

    li {
        margin: 0px;
        position: relative;
    }

    blockquote > :last-child {
        margin-bottom: 0px;
    }

    blockquote > :first-child, li > :first-child {
        margin-top: 0px;
    }

    .footnotes-area {
        color: rgb(136, 136, 136);
        margin-top: 0.714rem;
        padding-bottom: 0.143rem;
        white-space: normal;
    }

    #write .footnote-line {
        white-space: pre-wrap;
    }

    @media print {
        body, html {
            border: 1px solid transparent;
            height: 99%;
            break-after: avoid;
            break-before: avoid;
        }

        #write {
            margin-top: 0px;
            padding-top: 0px;
            border-color: transparent !important;
        }

        .typora-export * {
            -webkit-print-color-adjust: exact;
        }

        html.blink-to-pdf {
            font-size: 13px;
        }

        .typora-export #write {
            padding-left: 32px;
            padding-right: 32px;
            padding-bottom: 0px;
            break-after: avoid;
        }

        .typora-export #write::after {
            height: 0px;
        }

        @page {
            margin: 20mm 0px;
        }
    }

    .footnote-line {
        margin-top: 0.714em;
        font-size: 0.7em;
    }

    a img, img a {
        cursor: pointer;
    }

    pre.md-meta-block {
        font-size: 0.8rem;
        min-height: 0.8rem;
        white-space: pre-wrap;
        background: rgb(204, 204, 204);
        display: block;
        overflow-x: hidden;
    }

    p > .md-image:only-child:not(.md-img-error) img, p > img:only-child {
        display: block;
        margin: auto;
    }

    p > .md-image:only-child {
        display: inline-block;
        width: 100%;
    }

    #write .MathJax_Display {
        margin: 0.8em 0px 0px;
    }

    .md-math-block {
        width: 100%;
    }

    .md-math-block:not(:empty)::after {
        display: none;
    }

    [contenteditable="true"]:active, [contenteditable="true"]:focus {
        outline: 0px;
        box-shadow: none;
    }

    .md-task-list-item {
        position: relative;
        list-style-type: none;
    }

    .task-list-item.md-task-list-item {
        padding-left: 0px;
    }

    .md-task-list-item > input {
        position: absolute;
        top: 0px;
        left: 0px;
        margin-left: -1.2em;
        margin-top: calc(1em - 10px);
        border: none;
    }

    .math {
        font-size: 1rem;
    }

    .md-toc {
        min-height: 3.58rem;
        position: relative;
        font-size: 0.9rem;
        border-radius: 10px;
    }

    .md-toc-content {
        position: relative;
        margin-left: 0px;
    }

    .md-toc-content::after, .md-toc::after {
        display: none;
    }

    .md-toc-item {
        display: block;
        color: rgb(65, 131, 196);
    }

    .md-toc-item a {
        text-decoration: none;
    }

    .md-toc-inner:hover {
        text-decoration: underline;
    }

    .md-toc-inner {
        display: inline-block;
        cursor: pointer;
    }

    .md-toc-h1 .md-toc-inner {
        margin-left: 0px;
        font-weight: 700;
    }

    .md-toc-h2 .md-toc-inner {
        margin-left: 2em;
    }

    .md-toc-h3 .md-toc-inner {
        margin-left: 4em;
    }

    .md-toc-h4 .md-toc-inner {
        margin-left: 6em;
    }

    .md-toc-h5 .md-toc-inner {
        margin-left: 8em;
    }

    .md-toc-h6 .md-toc-inner {
        margin-left: 10em;
    }

    @media screen and (max-width: 48em) {
        .md-toc-h3 .md-toc-inner {
            margin-left: 3.5em;
        }

        .md-toc-h4 .md-toc-inner {
            margin-left: 5em;
        }

        .md-toc-h5 .md-toc-inner {
            margin-left: 6.5em;
        }

        .md-toc-h6 .md-toc-inner {
            margin-left: 8em;
        }
    }

    a.md-toc-inner {
        font-size: inherit;
        font-style: inherit;
        font-weight: inherit;
        line-height: inherit;
    }

    .footnote-line a:not(.reversefootnote) {
        color: inherit;
    }

    .md-attr {
        display: none;
    }

    .md-fn-count::after {
        content: ".";
    }

    code, pre, samp, tt {
        font-family: var(--monospace);
    }

    kbd {
        margin: 0px 0.1em;
        padding: 0.1em 0.6em;
        font-size: 0.8em;
        color: rgb(36, 39, 41);
        background: rgb(255, 255, 255);
        border: 1px solid rgb(173, 179, 185);
        border-radius: 3px;
        box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset;
        white-space: nowrap;
        vertical-align: middle;
    }

    .md-comment {
        color: rgb(162, 127, 3);
        opacity: 0.8;
        font-family: var(--monospace);
    }

    code {
        text-align: left;
        vertical-align: initial;
    }

    a.md-print-anchor {
        white-space: pre !important;
        border-width: initial !important;
        border-style: none !important;
        border-color: initial !important;
        display: inline-block !important;
        position: absolute !important;
        width: 1px !important;
        right: 0px !important;
        outline: 0px !important;
        background: 0px 0px !important;
        text-decoration: initial !important;
        text-shadow: initial !important;
    }

    .md-inline-math .MathJax_SVG .noError {
        display: none !important;
    }

    .html-for-mac .inline-math-svg .MathJax_SVG {
        vertical-align: 0.2px;
    }

    .md-math-block .MathJax_SVG_Display {
        text-align: center;
        margin: 0px;
        position: relative;
        text-indent: 0px;
        max-width: none;
        max-height: none;
        min-height: 0px;
        min-width: 100%;
        width: auto;
        overflow-y: hidden;
        display: block !important;
    }

    .MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display {
        width: auto;
        margin: inherit;
        display: inline-block !important;
    }

    .MathJax_SVG .MJX-monospace {
        font-family: var(--monospace);
    }

    .MathJax_SVG .MJX-sans-serif {
        font-family: sans-serif;
    }

    .MathJax_SVG {
        display: inline;
        font-style: normal;
        font-weight: 400;
        line-height: normal;
        zoom: 90%;
        text-indent: 0px;
        text-align: left;
        text-transform: none;
        letter-spacing: normal;
        word-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        float: none;
        direction: ltr;
        max-width: none;
        max-height: none;
        min-width: 0px;
        min-height: 0px;
        border: 0px;
        padding: 0px;
        margin: 0px;
    }

    .MathJax_SVG * {
        transition: none;
    }

    .MathJax_SVG_Display svg {
        vertical-align: middle !important;
        margin-bottom: 0px !important;
    }

    .os-windows.monocolor-emoji .md-emoji {
        font-family: "Segoe UI Symbol", sans-serif;
    }

    .md-diagram-panel > svg {
        max-width: 100%;
    }

    [lang="mermaid"] svg, [lang="flow"] svg {
        max-width: 100%;
    }

    [lang="mermaid"] .node text {
        font-size: 1rem;
    }

    table tr th {
        border-bottom: 0px;
    }

    video {
        max-width: 100%;
        display: block;
        margin: 0px auto;
    }

    iframe {
        max-width: 100%;
        width: 100%;
        border: none;
    }

    .highlight td, .highlight tr {
        border: 0px;
    }


    .CodeMirror {
        height: auto;
    }

    .CodeMirror.cm-s-inner {
        background: inherit;
    }

    .CodeMirror-scroll {
        overflow-y: hidden;
        overflow-x: auto;
        z-index: 3;
    }

    .CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler {
        background-color: rgb(255, 255, 255);
    }

    .CodeMirror-gutters {
        border-right: 1px solid rgb(221, 221, 221);
        background: inherit;
        white-space: nowrap;
    }

    .CodeMirror-linenumber {
        padding: 0px 3px 0px 5px;
        text-align: right;
        color: rgb(153, 153, 153);
    }

    .cm-s-inner .cm-keyword {
        color: rgb(119, 0, 136);
    }

    .cm-s-inner .cm-atom, .cm-s-inner.cm-atom {
        color: rgb(34, 17, 153);
    }

    .cm-s-inner .cm-number {
        color: rgb(17, 102, 68);
    }

    .cm-s-inner .cm-def {
        color: rgb(0, 0, 255);
    }

    .cm-s-inner .cm-variable {
        color: rgb(0, 0, 0);
    }

    .cm-s-inner .cm-variable-2 {
        color: rgb(0, 85, 170);
    }

    .cm-s-inner .cm-variable-3 {
        color: rgb(0, 136, 85);
    }

    .cm-s-inner .cm-string {
        color: rgb(170, 17, 17);
    }

    .cm-s-inner .cm-property {
        color: rgb(0, 0, 0);
    }

    .cm-s-inner .cm-operator {
        color: rgb(152, 26, 26);
    }

    .cm-s-inner .cm-comment, .cm-s-inner.cm-comment {
        color: rgb(170, 85, 0);
    }

    .cm-s-inner .cm-string-2 {
        color: rgb(255, 85, 0);
    }

    .cm-s-inner .cm-meta {
        color: rgb(85, 85, 85);
    }

    .cm-s-inner .cm-qualifier {
        color: rgb(85, 85, 85);
    }

    .cm-s-inner .cm-builtin {
        color: rgb(51, 0, 170);
    }

    .cm-s-inner .cm-bracket {
        color: rgb(153, 153, 119);
    }

    .cm-s-inner .cm-tag {
        color: rgb(17, 119, 0);
    }

    .cm-s-inner .cm-attribute {
        color: rgb(0, 0, 204);
    }

    .cm-s-inner .cm-header, .cm-s-inner.cm-header {
        color: rgb(0, 0, 255);
    }

    .cm-s-inner .cm-quote, .cm-s-inner.cm-quote {
        color: rgb(0, 153, 0);
    }

    .cm-s-inner .cm-hr, .cm-s-inner.cm-hr {
        color: rgb(153, 153, 153);
    }

    .cm-s-inner .cm-link, .cm-s-inner.cm-link {
        color: rgb(0, 0, 204);
    }

    .cm-negative {
        color: rgb(221, 68, 68);
    }

    .cm-positive {
        color: rgb(34, 153, 34);
    }

    .cm-header, .cm-strong {
        font-weight: 700;
    }

    .cm-del {
        text-decoration: line-through;
    }

    .cm-em {
        font-style: italic;
    }

    .cm-link {
        text-decoration: underline;
    }

    .cm-error {
        color: red;
    }

    .cm-invalidchar {
        color: red;
    }

    .cm-constant {
        color: rgb(38, 139, 210);
    }

    .cm-defined {
        color: rgb(181, 137, 0);
    }

    div.CodeMirror span.CodeMirror-matchingbracket {
        color: rgb(0, 255, 0);
    }

    div.CodeMirror span.CodeMirror-nonmatchingbracket {
        color: rgb(255, 34, 34);
    }

    .cm-s-inner .CodeMirror-activeline-background {
        background: inherit;
    }

    .CodeMirror {
        position: relative;
        overflow: hidden;
    }

    .CodeMirror-scroll {
        height: 100%;
        outline: 0px;
        position: relative;
        box-sizing: content-box;
        background: inherit;
    }

    .CodeMirror-sizer {
        position: relative;
    }

    .CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar {
        position: absolute;
        z-index: 6;
        display: none;
    }

    .CodeMirror-vscrollbar {
        right: 0px;
        top: 0px;
        overflow: hidden;
    }

    .CodeMirror-hscrollbar {
        bottom: 0px;
        left: 0px;
        overflow: hidden;
    }

    .CodeMirror-scrollbar-filler {
        right: 0px;
        bottom: 0px;
    }

    .CodeMirror-gutter-filler {
        left: 0px;
        bottom: 0px;
    }

    .CodeMirror-gutters {
        position: absolute;
        left: 0px;
        top: 0px;
        padding-bottom: 30px;
        z-index: 3;
    }

    .CodeMirror-gutter {
        white-space: normal;
        height: 100%;
        box-sizing: content-box;
        padding-bottom: 30px;
        margin-bottom: -32px;
        display: inline-block;
    }

    .CodeMirror-gutter-wrapper {
        position: absolute;
        z-index: 4;
        background: 0px 0px !important;
        border: none !important;
    }

    .CodeMirror-gutter-background {
        position: absolute;
        top: 0px;
        bottom: 0px;
        z-index: 4;
    }

    .CodeMirror-gutter-elt {
        position: absolute;
        cursor: default;
        z-index: 4;
    }

    .CodeMirror-lines {
        cursor: text;
    }

    .CodeMirror pre {
        border-radius: 0px;
        border-width: 0px;
        background: 0px 0px;
        font-family: inherit;
        font-size: inherit;
        margin: 0px;
        white-space: pre;
        word-wrap: normal;
        color: inherit;
        z-index: 2;
        position: relative;
        overflow: visible;
    }

    .CodeMirror-wrap pre {
        word-wrap: break-word;
        white-space: pre-wrap;
        word-break: normal;
    }

    .CodeMirror-code pre {
        border-right: 30px solid transparent;
        width: fit-content;
    }

    .CodeMirror-wrap .CodeMirror-code pre {
        border-right: none;
        width: auto;
    }

    .CodeMirror-linebackground {
        position: absolute;
        left: 0px;
        right: 0px;
        top: 0px;
        bottom: 0px;
        z-index: 0;
    }

    .CodeMirror-linewidget {
        position: relative;
        z-index: 2;
        overflow: auto;
    }

    .CodeMirror-wrap .CodeMirror-scroll {
        overflow-x: hidden;
    }

    .CodeMirror-measure {
        position: absolute;
        width: 100%;
        height: 0px;
        overflow: hidden;
        visibility: hidden;
    }

    .CodeMirror-measure pre {
        position: static;
    }

    .CodeMirror div.CodeMirror-cursor {
        position: absolute;
        visibility: hidden;
        border-right: none;
        width: 0px;
    }

    .CodeMirror div.CodeMirror-cursor {
        visibility: hidden;
    }

    .CodeMirror-focused div.CodeMirror-cursor {
        visibility: inherit;
    }

    .cm-searching {
        background: rgba(255, 255, 0, 0.4);
    }

    @media print {
        .CodeMirror div.CodeMirror-cursor {
            visibility: hidden;
        }
    }


    :root {
        --active-file-bg-color: rgba(32, 43, 51, 0.63);
        --active-file-text-color: white;
        --bg-color: #f3f2ee;
        --text-color: #1f0909;
        --control-text-color: #444;
        --rawblock-edit-panel-bd: #e5e5e5;
        --select-text-bg-color: rgba(32, 43, 51, 0.63);
        --select-text-font-color: white;
    }

    pre {
        --select-text-bg-color: #36284e;
        --select-text-font-color: #fff;
    }

    html {
        font-size: 16px;
    }

    html, body {
        background-color: rgb(243, 242, 238);
        font-family: "PT Serif", "Times New Roman", Times, serif;
        color: rgb(31, 9, 9);
        line-height: 1.5em;
    }

    #write {
        max-width: 40em;
    }

    ol li {
        list-style-type: decimal;
        list-style-position: outside;
    }

    ul li {
        list-style-type: disc;
        list-style-position: outside;
    }

    ol, ul {
        list-style: none;
    }

    blockquote, q {
        quotes: none;
    }

    blockquote::before, blockquote::after, q::before, q::after {
        content: none;
    }

    table {
        border-collapse: collapse;
        border-spacing: 0px;
    }

    h1, h2, h3, h4, h5, h6 {
        font-weight: bold;
    }

    h1 {
        font-size: 1.875em;
        line-height: 1.6em;
        margin-top: 2em;
    }

    h2, h3 {
        font-size: 1.3125em;
        line-height: 1.15;
        margin-top: 2.28571em;
        margin-bottom: 1.15em;
    }

    h3 {
        font-weight: normal;
    }

    h4 {
        font-size: 1.125em;
        margin-top: 2.67em;
    }

    h5, h6 {
        font-size: 1em;
    }

    h1 {
        border-bottom: 1px solid;
        margin-bottom: 1.875em;
        padding-bottom: 0.8125em;
    }

    a {
        text-decoration: none;
        color: rgb(6, 85, 136);
    }

    a:hover, a:active {
        text-decoration: underline;
    }

    p, blockquote, .md-fences {
        margin-bottom: 1.5em;
    }

    h1, h2, h3, h4, h5, h6 {
        margin-bottom: 1.5em;
    }

    blockquote {
        font-style: italic;
        border-left: 5px solid;
        margin-left: 2em;
        padding-left: 1em;
    }

    ul, ol {
        margin: 0px 0px 1.5em 1.5em;
    }

    .md-meta, .md-before, .md-after {
        color: rgb(153, 153, 153);
    }

    table {
        margin-bottom: 1.5em;
        font-size: 1em;
    }

    thead th, tfoot th {
        padding: 0.25em 0.25em 0.25em 0.4em;
        text-transform: uppercase;
    }

    th {
        text-align: left;
    }

    td {
        vertical-align: top;
        padding: 0.25em 0.25em 0.25em 0.4em;
    }

    code, .md-fences {
        background-color: rgb(218, 218, 218);
    }

    code {
        padding-left: 2px;
        padding-right: 2px;
    }

    .md-fences {
        margin-left: 2em;
        margin-bottom: 3em;
        padding-left: 1ch;
        padding-right: 1ch;
    }

    pre, code, tt {
        font-size: 0.875em;
        line-height: 1.71429em;
    }

    h1 {
        line-height: 1.3em;
        font-weight: normal;
        margin-bottom: 0.5em;
    }

    p + ul, p + ol {
        margin-top: 0.5em;
    }

    h3 + ul, h4 + ul, h5 + ul, h6 + ul, h3 + ol, h4 + ol, h5 + ol, h6 + ol {
        margin-top: 0.5em;
    }

    li > ul, li > ol {
        margin-top: inherit;
        margin-bottom: 0px;
    }

    li ol > li {
        list-style-type: lower-alpha;
    }

    li li ol > li {
        list-style-type: lower-roman;
    }

    h2, h3 {
        margin-bottom: 0.75em;
    }

    hr {
        border-top: none;
        border-right: none;
        border-bottom: 1px solid;
        border-left: none;
    }

    h1 {
        border-color: rgb(197, 197, 197);
    }

    blockquote {
        border-color: rgb(186, 186, 186);
        color: rgb(101, 101, 101);
    }

    blockquote ul, blockquote ol {
        margin-left: 0px;
    }

    .ty-table-edit {
        background-color: transparent;
    }

    thead {
        background-color: rgb(218, 218, 218);
    }

    tr:nth-child(2n) {
        background: rgb(232, 231, 231);
    }

    hr {
        border-color: rgb(197, 197, 197);
    }

    .task-list {
        padding-left: 1rem;
    }

    .md-task-list-item {
        padding-left: 1.5rem;
        list-style-type: none;
    }

    .md-task-list-item > input::before {
        content: "√";
        display: inline-block;
        width: 1.25rem;
        height: 1.6rem;
        vertical-align: middle;
        text-align: center;
        color: rgb(221, 221, 221);
        background-color: rgb(243, 242, 238);
    }

    .md-task-list-item > input:checked::before, .md-task-list-item > input[checked]::before {
        color: inherit;
    }

    #write pre.md-meta-block {
        min-height: 1.875rem;
        color: rgb(85, 85, 85);
        border: 0px;
        background: transparent;
        margin-left: 1em;
        margin-top: 1em;
    }

    .md-image > .md-meta {
        color: rgb(155, 81, 70);
    }

    .md-image > .md-meta {
        font-family: Menlo, "Ubuntu Mono", Consolas, "Courier New", "Microsoft Yahei", "Hiragino Sans GB", "WenQuanYi Micro Hei", serif;
    }

    #write > h3.md-focus::before {
        left: -1.5rem;
        color: rgb(153, 153, 153);
        border-color: rgb(153, 153, 153);
    }

    #write > h4.md-focus::before {
        left: -1.5rem;
        top: 0.25rem;
        color: rgb(153, 153, 153);
        border-color: rgb(153, 153, 153);
    }

    #write > h5.md-focus::before {
        left: -1.5rem;
        color: rgb(153, 153, 153);
        border-color: rgb(153, 153, 153);
    }

    #write > h6.md-focus::before {
        left: -1.5rem;
        top: 0.3125rem;
        color: rgb(153, 153, 153);
        border-color: rgb(153, 153, 153);
    }

    .md-toc:focus .md-toc-content {
        margin-top: 19px;
    }

    .md-toc-content:empty::before {
        color: rgb(6, 85, 136);
    }

    .md-toc-item {
        color: rgb(6, 85, 136);
    }

    #write div.md-toc-tooltip {
        background-color: rgb(243, 242, 238);
    }

    #typora-sidebar {
        background-color: rgb(243, 242, 238);
        box-shadow: rgba(0, 0, 0, 0.376) 0px 6px 12px;
    }

    .pin-outline #typora-sidebar {
        background: inherit;
        box-shadow: none;
        border-right: 1px dashed;
    }

    .pin-outline #typora-sidebar:hover .outline-title-wrapper {
        border-left: 1px dashed;
    }

    .outline-item:hover {
        background-color: rgb(218, 218, 218);
        border-left: 28px solid rgb(218, 218, 218);
        border-right: 18px solid rgb(218, 218, 218);
    }

    .typora-node .outline-item:hover {
        border-right: 28px solid rgb(218, 218, 218);
    }

    .outline-expander::before {
        content: "";
        font-family: FontAwesome;
        font-size: 14px;
        top: 1px;
    }

    .outline-expander:hover::before, .outline-item-open > .outline-item > .outline-expander::before {
        content: "";
    }

    .modal-content {
        background-color: rgb(243, 242, 238);
    }

    .auto-suggest-container ul li {
        list-style-type: none;
    }

    .megamenu-menu, #top-titlebar, #top-titlebar *, .megamenu-content {
        background: rgb(243, 242, 238);
        color: rgb(31, 9, 9);
    }

    .megamenu-menu-header {
        border-bottom: 1px dashed rgb(32, 43, 51);
    }

    .megamenu-menu {
        box-shadow: none;
        border-right: 1px dashed;
    }

    header, .context-menu, .megamenu-content, footer {
        font-family: "PT Serif", "Times New Roman", Times, serif;
        color: rgb(31, 9, 9);
    }

    #megamenu-back-btn {
        color: rgb(31, 9, 9);
        border-color: rgb(31, 9, 9);
    }

    .megamenu-menu-header #megamenu-menu-header-title::before {
        color: rgb(31, 9, 9);
    }

    .megamenu-menu-list li a:hover, .megamenu-menu-list li a.active {
        color: inherit;
        background-color: rgb(232, 231, 223);
    }

    .long-btn:hover {
        background-color: rgb(232, 231, 223);
    }

    #recent-file-panel tbody tr:nth-child(2n-1) {
        background-color: transparent !important;
    }

    .megamenu-menu-panel tbody tr:hover td:nth-child(2) {
        color: inherit;
    }

    .megamenu-menu-panel .btn {
        background-color: rgb(210, 209, 209);
    }

    .btn-default {
        background-color: transparent;
    }

    .typora-sourceview-on #toggle-sourceview-btn, .ty-show-word-count #footer-word-count {
        background: rgb(199, 197, 197);
    }

    #typora-quick-open {
        background-color: inherit;
    }

    .md-diagram-panel {
        margin-top: 8px;
    }

    .file-list-item-file-name {
        font-weight: initial;
    }

    .file-list-item-summary {
        opacity: 1;
    }

    .file-list-item {
        color: rgb(119, 119, 119);
    }

    .file-list-item.active {
        background-color: inherit;
        color: black;
    }

    .ty-side-sort-btn.active {
        background-color: inherit;
    }

    .file-list-item.active .file-list-item-file-name {
        font-weight: bold;
    }

    .file-list-item {
        opacity: 1 !important;
    }

    .file-library-node.active > .file-node-background {
        background-color: var(--active-file-bg-color);
    }

    .file-tree-node.active > .file-node-content {
        color: var(--active-file-text-color);
    }

    .md-task-list-item > input {
        margin-left: -1.6em;
        margin-top: calc(1rem - 12px);
    }

    input {
        border: 1px solid rgb(170, 170, 170);
    }

    .megamenu-menu-header #megamenu-menu-header-title, .megamenu-menu-header:hover, .megamenu-menu-header:focus {
        color: inherit;
    }

    .dropdown-menu .divider {
        border-color: rgb(229, 229, 229);
    }

    .os-windows-7 strong, .os-windows-7 strong {
        font-weight: 760;
    }


    .typora-export li, .typora-export p, .typora-export, .footnote-line {
        white-space: normal;
    }
    </style>
</head>
<body class='typora-export os-windows'>
<div id='write' class='is-node'><h1><a name='header-n0' class='md-header-anchor '></a>第13章 多线程</h1>
    <h2><a name='header-n2' class='md-header-anchor '></a>学习目标</h2>
    <ul>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>说出进程的概念</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>说出线程的概念</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够理解并发与并行的区别</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够开启新线程</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够描述Java中多线程运行原理</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够使用继承类的方式创建多线程</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够使用实现接口的方式创建多线程</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够说出实现接口方式的好处</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够解释安全问题的出现的原因</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够使用同步代码块解决线程安全问题</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够使用同步方法解决线程安全问题</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够说出线程6个状态的名称</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够理解线程通信概念</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够理解等待唤醒机制</p></li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled'/>
            <p>能够说出线程的生命周期</p></li>
    </ul>
    <h1><a name='header-n34' class='md-header-anchor '></a>第十三章 多线程</h1>
    <p>我们在之前，学习的程序在没有跳转语句的前提下，都是由上至下依次执行，那现在想要设计一个程序，边打游戏边听歌，怎么设计？</p>
    <p>要解决上述问题,咱们得使用多进程或者多线程来解决.</p>
    <h2><a name='header-n37' class='md-header-anchor '></a>13.1 相关概念</h2>
    <h3><a name='header-n38' class='md-header-anchor '></a>13.1.1 并发与并行（了解）</h3>
    <ul>
        <li><strong>并行</strong>（parallel）：指多个事件任务在<strong>同一时刻</strong>发生（同时发生）。指在同一时刻，有多条指令在多个处理器上同时执行。单核CPU同一时刻只能处理一条指令，所以单核CPU做不到并行处理。
        </li>
        <li><strong>并发</strong>（concurrency）：指两个或多个事件在<strong>同一个微小的时间段内</strong>发生。指在同一个时刻只能有一条指令执行，但多个进程的指令被快速轮换执行，使得在宏观上具有多个进程同时执行的效果。程序并发执行可以在有限条件下，充分利用CPU资源，这是我们研究的重点。
        </li>
    </ul>
    <p><img src='imgs13\并行与并发.bmp' alt='' referrerPolicy='no-referrer'/></p>
    <p>在操作系统中，安装了多个程序，并发指的是在一段时间内宏观上有多个程序同时运行，这在单 CPU
        系统中，每一时刻只能有一个程序执行，即微观上这些程序是分时的交替运行，只不过是给人的感觉是同时运行，那是因为分时交替运行的时间是非常短的。</p>
    <p>而在多个 CPU 系统中，则这些可以并发执行的程序便可以分配到多个处理器上（CPU），实现多任务并行执行，即利用每个处理器来处理一个可以并发执行的程序，这样多个程序便可以同时执行。目前电脑市场上说的多核
        CPU，便是多核处理器，核越多，<strong>并行</strong>处理的程序越多，能大大的提高电脑运行的效率。</p>
    <blockquote><p>注意：<strong>单核</strong>处理器的计算机肯定是<strong>不能并行</strong>的处理多个任务的，只能是多个任务在单个CPU上并发运行。同理，线程也是一样的，从宏观角度上理解线程是并行运行的，但是从微观角度上分析却是串行运行的，即一个线程一个线程的去运行，当系统只有一个CPU时，线程会以某种顺序执行多个线程，我们把这种情况称之为线程调度。
    </p></blockquote>
    <p>单核CPU：只能并发</p>
    <p>多核CPU：并行+并发</p>
    <p>例子：</p>
    <ul>
        <li>并行：多项工作一起执行，之后再汇总，例如：泡方便面，电水壶烧水，一边撕调料倒入桶中</li>
        <li>并发：同一时刻多个线程在访问同一个资源，多个线程对一个点，例如：春运抢票、电商秒杀...</li>
    </ul>
    <h3><a name='header-n57' class='md-header-anchor '></a>13.1.2 线程与进程</h3>
    <ul>
        <li><p><strong>程序</strong>：为了完成某个任务和功能，选择一种编程语言编写的一组指令的集合。</p></li>
        <li><p><strong>软件</strong>：1个或多个应用程序+相关的素材和资源文件等构成一个软件系统。</p></li>
        <li><p><strong>进程</strong>：进程是对一个程序运行过程（创建-运行-消亡）的描述，系统会为每个运行的程序建立一个进程，并为进程分配独立的系统资源，比如内存空间等资源。</p></li>
        <li><p><strong>线程</strong>：线程是进程中的一个执行单元，负责完成执行当前程序的任务，一个进程中至少有一个线程。一个进程中是可以有多个线程的，这时这个应用程序也可以称之为多线程程序。多线程使得程序可以并发执行，充分利用CPU资源。
        </p>
            <p><strong>面试题</strong>：进程是操作系统调度和分配资源的最小单位，线程是CPU调度的最小单位。不同的进程之间是不共享内存的。进程之间的数据交换和通信的成本是很高。不同的线程是共享同一个进程的内存的。当然不同的线程也有自己独立的内存空间。对于方法区，堆中中的同一个对象的内存，线程之间是可以共享的，但是栈的局部变量永远是独立的。
            </p></li>
    </ul>
    <p>例如：</p>
    <p><strong>每个应用程序的运行都是一个进程</strong></p>
    <p>我们可以再电脑底部任务栏，右键-----&gt;打开任务管理器,可以查看当前任务的进程：</p>
    <p><img src='imgs13\进程概念.png' alt='' referrerPolicy='no-referrer'/></p>
    <p><strong>一个应用程序的多次运行，就是多个进程</strong></p>
    <p><img src='imgs13/1563267431480.png' alt='1563267431480' referrerPolicy='no-referrer'/></p>
    <p><strong>一个进程中包含多个线程</strong></p>
    <p><img src='imgs13/1563270525077.png' alt='1563270525077' referrerPolicy='no-referrer'/></p>
    <h3><a name='header-n76' class='md-header-anchor '></a>13.1.3多线程的优点与应用场景</h3>
    <ul>
        <li><p><strong>主要优点：</strong></p>
            <ul>
                <li>充分利用CUP空闲时间片，用尽可能短的时间完成用户的请求。也就是使程序的响应速度更快 。</li>
            </ul>
        </li>
        <li><p><strong>应用场景：</strong></p>
            <ul>
                <li>多任务处理。多个用户请求服务器，服务端程序可以开启多个线程分别处理每个用户的请求，互不影响。</li>
                <li>单个大任务处理。下载一个大文件，可以开启多个线程一起下载，减少整体下载时间。</li>
            </ul>
        </li>
    </ul>
    <h3><a name='header-n90' class='md-header-anchor '></a>13.1.4 线程调度</h3>
    <p>指CPU资源如何分配给不同的线程。常见的两种线程调度方式：</p>
    <ul>
        <li><p>分时调度</p>
            <p>所有线程轮流使用 CPU 的使用权，平均分配每个线程占用 CPU 的时间。</p></li>
        <li><p>抢占式调度</p>
            <p>优先让优先级高的线程使用 CPU，如果线程的优先级相同，那么会随机选择一个(线程随机性)，<strong>Java采用的是抢占式调度方式</strong>。</p>
            <ul>
                <li><p>抢占式调度详解</p>
                    <p>
                        大部分操作系统都支持多进程并发运行，现在的操作系统几乎都支持同时运行多个程序。比如：现在我们上课一边使用编辑器，一边使用录屏软件，同时还开着画图板，dos窗口等软件。此时，这些程序是在同时运行，”感觉这些软件好像在同一时刻运行着“。</p>
                    <p>实际上，CPU(中央处理器)使用抢占式调度模式在多个线程间进行着高速的切换。对于CPU的一个核而言，某个时刻，只能执行一个线程，而
                        CPU的在多个线程间切换速度相对我们的感觉要快，看上去就是在同一时刻运行。
                        其实，多线程程序并不能提高程序的运行速度，但能够提高程序运行效率，让CPU的使用率更高。</p>
                    <p><img src='imgs13/抢占式调度.bmp' alt='抢占式调度' referrerPolicy='no-referrer'/></p></li>
            </ul>
        </li>
    </ul>
    <h2><a name='header-n105' class='md-header-anchor '></a>13.2 线程的创建与启动</h2>
    <p>java虚拟机是支持多线程的，当运行Java程序时，至少已经有一个线程了，那就是main线程。</p>
    <p><img src='imgs13/1563281796505.png' alt='1563281796505' referrerPolicy='no-referrer'/></p>
    <p>那么如何创建和启动一个新的线程呢？创建线程的简单方式有两种：</p>
    <h3><a name='header-n109' class='md-header-anchor '></a>13.2.1 继承Thread类</h3>
    <p>Java中<code>java.lang.Thread</code>是表示线程的类，每个Thread类或其子类的实例代表一个线程对象。</p>
    <p><strong>通过继承Thread类来创建并启动多线程的步骤:</strong></p>
    <ol start=''>
        <li>定义Thread类的子类，并重写该类的run()方法，该run()方法的方法体就代表了线程需要完成的任务,因此把run()方法称为线程执行体。</li>
        <li>创建Thread子类的实例，即创建了线程对象</li>
        <li>调用线程对象的start()方法来启动该线程</li>
    </ol>
    <p><strong>自定义线程类：</strong></p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"
         style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                      style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">MyThread</span> <span
            class="cm-keyword">extends</span> <span class="cm-variable">Thread</span> {</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//定义指定线程名称的构造方法</span></span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span
            class="cm-variable">MyThread</span>(<span class="cm-variable-3">String</span> <span
            class="cm-variable">name</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span><span class="cm-tab"
                                                                                                    role="presentation"
                                                                                                    cm-text="	">    </span><span
            class="cm-comment">//调用父类的String参数的构造方法，指定线程的名称</span></span></pre><pre class=" CodeMirror-line "
                                                                                    role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span><span class="cm-tab"
                                                                                                    role="presentation"
                                                                                                    cm-text="	">    </span><span
            class="cm-keyword">super</span>(<span class="cm-variable">name</span>);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line "
                                                                                            role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span><span class="cm-comment">/**</span></span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span> <span
            class="cm-comment">* 重写run方法，完成该线程执行的逻辑</span></span></pre><pre class=" CodeMirror-line "
                                                                            role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span> <span class="cm-comment">*/</span></span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span
            class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span><span class="cm-keyword">public</span> <span
            class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation"
                                                                               cm-text="	">    </span><span
            class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span
            class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span
            class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">10</span>; <span
            class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation"
                                                                               cm-text="	">    </span><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span
            class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span
            class="cm-variable">getName</span>()<span class="cm-operator">+</span><span
            class="cm-string">"：正在执行！"</span><span class="cm-operator">+</span><span
            class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span><span class="cm-tab"
                                                                                                    role="presentation"
                                                                                                    cm-text="	">    </span>}</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line "
                                                                                            role="presentation"><span
            role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 395px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 395px;"></div></div></div></pre>
    <p><strong>测试类：创建线程对象并启动线程</strong></p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                      style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">Demo01</span> {</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span
            class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span
            class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span
            class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span><span class="cm-tab"
                                                                                                    role="presentation"
                                                                                                    cm-text="	">    </span><span
            class="cm-comment">//创建自定义线程对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span><span class="cm-tab"
                                                                                                    role="presentation"
                                                                                                    cm-text="	">    </span><span
            class="cm-variable">MyThread</span> <span class="cm-variable">mt</span> <span
            class="cm-operator">=</span> <span class="cm-keyword">new</span> <span
            class="cm-variable">MyThread</span>(<span class="cm-string">"新的线程！"</span>);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation"
                                                                               cm-text="	">    </span><span
            class="cm-comment">//开启新线程</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span><span class="cm-tab"
                                                                                                    role="presentation"
                                                                                                    cm-text="	">    </span><span
            class="cm-variable">mt</span>.<span class="cm-variable">start</span>();</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation"
                                                                               cm-text="	">    </span><span
            class="cm-comment">//在主方法中执行for循环</span></span></pre><pre class=" CodeMirror-line "
                                                                      role="presentation"><span role="presentation"
                                                                                                style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation"
                                                                               cm-text="	">    </span><span
            class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span
            class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span
            class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">10</span>; <span
            class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation"
                                                                               cm-text="	">    </span><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span
            class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span
            class="cm-string">"main线程！"</span><span class="cm-operator">+</span><span
            class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span><span class="cm-tab"
                                                                                                    role="presentation"
                                                                                                    cm-text="	">    </span>}</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line "
                                                                                            role="presentation"><span
            role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 296px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 296px;"></div></div></div></pre>
    <p><strong>多线程执行情况分析</strong></p>
    <p><img src="imgs13\多线程执行.png" style="zoom:50%;"/></p>
    <p><strong>注意事项：</strong></p>
    <ul>
        <li>手动调用run方法不是启动线程的方式，只是普通方法调用。</li>
        <li>start方法启动线程后，run方法会由JVM调用执行。</li>
        <li>不要重复启动同一个线程，否则抛出异常<code>IllegalThreadStateException</code></li>
        <li>不要使用Junit单元测试多线程，不支持，主线程结束后会调用<code>System.exit()</code>直接退出JVM;</li>
    </ul>
    <h3><a name='header-n135' class='md-header-anchor '></a>13.2.2 实现Runnable接口</h3>
    <p>
        Java有单继承的限制，当我们无法继承Thread类时，那么该如何做呢？在核心类库中提供了Runnable接口，我们可以实现Runnable接口，重写run()方法，然后再通过Thread类的对象代理启动和执行我们的线程体run()方法</p>
    <p><strong>通过实现Runnable接口创建线程并启动的步骤:</strong></p>
    <ol start=''>
        <li>定义Runnable接口的实现类，并重写该接口的run()方法，该run()方法的方法体同样是该线程的线程执行体。</li>
        <li>创建Runnable实现类的实例，并以此实例作为Thread的target来创建Thread对象，该Thread对象才是真正
            的线程对象。
        </li>
        <li>调用线程对象的start()方法来启动线程。</li>
    </ol>
    <p><strong>自定义线程任务类：</strong></p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                      style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-keyword">public</span>&nbsp;<span class="cm-keyword">class</span>&nbsp;<span class="cm-def">MyRunnable</span>&nbsp;<span
            class="cm-keyword">implements</span>&nbsp;<span class="cm-variable">Runnable</span>{</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                style="padding-right: 0.1px;">  <span class="cm-tab"
                                                                                                      role="presentation"
                                                                                                      cm-text="	">  </span><span
            class="cm-meta">@Override</span>&nbsp;&nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span
            class="cm-keyword">public</span>&nbsp;<span class="cm-variable-3">void</span>&nbsp;<span
            class="cm-variable">run</span>()&nbsp;{</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span
            class="cm-keyword">for</span>&nbsp;(<span class="cm-variable-3">int</span>&nbsp;<span
            class="cm-variable">i</span>&nbsp;<span class="cm-operator">=</span>&nbsp;<span class="cm-number">0</span>;&nbsp;<span
            class="cm-variable">i</span>&nbsp;<span class="cm-operator">&lt;</span>&nbsp;<span
            class="cm-number">20</span>;&nbsp;<span class="cm-variable">i</span><span class="cm-operator">++</span>)&nbsp;{</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span
            class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">System</span>.<span
            class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span
            class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span
            class="cm-variable">getName</span>()<span class="cm-operator">+</span><span
            class="cm-string">"&nbsp;"</span><span class="cm-operator">+</span><span class="cm-variable">i</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                style="padding-right: 0.1px;">  <span class="cm-tab"
                                                                                                      role="presentation"
                                                                                                      cm-text="	">  </span><span
            class="cm-tab" role="presentation"
            cm-text="	">    </span>}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                style="padding-right: 0.1px;">  <span class="cm-tab"
                                                                                                      role="presentation"
                                                                                                      cm-text="	">  </span>}&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 247px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 247px;"></div></div></div></pre>
    <p><strong>测试类：创建线程对象并启动线程</strong></p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                      style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span
            class="cm-keyword">public</span>&nbsp;<span class="cm-keyword">class</span>&nbsp;<span
            class="cm-def">Demo</span>&nbsp;{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;">  &nbsp;&nbsp;&nbsp;&nbsp;<span
            class="cm-keyword">public</span>&nbsp;<span class="cm-keyword">static</span>&nbsp;<span
            class="cm-variable-3">void</span>&nbsp;<span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[]&nbsp;<span
            class="cm-variable">args</span>)&nbsp;{</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
            class="cm-comment">//创建自定义类对象&nbsp;&nbsp;线程任务对象</span></span></pre><pre class=" CodeMirror-line "
                                                                                    role="presentation"><span
            role="presentation" style="padding-right: 0.1px;">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
            class="cm-variable">MyRunnable</span>&nbsp;<span class="cm-variable">mr</span>&nbsp;<span
            class="cm-operator">=</span>&nbsp;<span class="cm-keyword">new</span>&nbsp;<span class="cm-variable">MyRunnable</span>();</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
            class="cm-comment">//创建线程对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
            class="cm-variable">Thread</span>&nbsp;<span class="cm-variable">t</span>&nbsp;<span
            class="cm-operator">=</span>&nbsp;<span class="cm-keyword">new</span>&nbsp;<span
            class="cm-variable">Thread</span>(<span class="cm-variable">mr</span>,&nbsp;<span
            class="cm-string">"小强"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
            class="cm-variable">t</span>.<span class="cm-variable">start</span>();</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
            class="cm-keyword">for</span>&nbsp;(<span class="cm-variable-3">int</span>&nbsp;<span
            class="cm-variable">i</span>&nbsp;<span class="cm-operator">=</span>&nbsp;<span class="cm-number">0</span>;&nbsp;<span
            class="cm-variable">i</span>&nbsp;<span class="cm-operator">&lt;</span>&nbsp;<span
            class="cm-number">20</span>;&nbsp;<span class="cm-variable">i</span><span class="cm-operator">++</span>)&nbsp;{</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
            class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span
            class="cm-variable">println</span>(<span class="cm-string">"旺财&nbsp;"</span>&nbsp;<span class="cm-operator">+</span>&nbsp;<span
            class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  &nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 296px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 296px;"></div></div></div></pre>
    <h3><a name='header-n149' class='md-header-anchor '></a>13.2.3 两种创建线程方式比较</h3>
    <ul>
        <li><p>Thread类本身也是实现了Runnable接口的，run方法都来自Runnable接口，run方法也是真正要执行的线程任务。</p>
            <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
                    class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
                    style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea
                    autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
                    style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
                    class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div
                    class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll"
                                                                                      tabindex="-1"><div
                    class="CodeMirror-sizer"
                    style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
                    style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
                    role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
                    class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
                    class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline"
                                                                     style="position: relative;"><div
                    class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
                    class="CodeMirror-gutter-background CodeMirror-activeline-gutter"
                    style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span
                    role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span
                    class="cm-keyword">class</span> <span class="cm-def">Thread</span> <span class="cm-keyword">implements</span> <span
                    class="cm-variable">Runnable</span> {}</span></pre></div></div></div></div></div></div><div
                    style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 25px;"></div><div
                    class="CodeMirror-gutters" style="display: none; height: 25px;"></div></div></div></pre>
        </li>
        <li><p>因为Java类是单继承的，所以继承Thread的方式有单继承的局限性，但是使用上更简单一些。</p></li>
        <li><p>实现Runnable接口的方式，避免了单继承的局限性，并且可以使多个线程对象共享一个Runnable实现类（线程任务类）对象，从而方便在多线程任务执行时共享数据。</p></li>
    </ul>
    <h3><a name='header-n158' class='md-header-anchor '></a>13.2.4 匿名内部类对象创建线程</h3>
    <p>匿名内部类对象的方式创建线程，并不是一种新的创建线程的方式，只是在线程任务只需执行一次的情况下，我们无需单独创建线程类，可以采用匿名对象的方式：</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                      style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-string">"新的线程！"</span>){</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span
            class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span><span class="cm-keyword">public</span> <span
            class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation"
                                                                               cm-text="	">    </span><span
            class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span
            class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span
            class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">10</span>; <span
            class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation"
                                                                               cm-text="	">    </span><span
            class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span
            class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span
            class="cm-variable">getName</span>()<span class="cm-operator">+</span><span
            class="cm-string">"：正在执行！"</span><span class="cm-operator">+</span><span
            class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation"
                                                                    cm-text="	">    </span><span class="cm-tab"
                                                                                                    role="presentation"
                                                                                                    cm-text="	">    </span>}</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line "
                                                                                            role="presentation"><span
            role="presentation" style="padding-right: 0.1px;">}.<span
            class="cm-variable">start</span>();</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 197px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 197px;"></div></div></div></pre>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div
            class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div
            class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline"
                                                                      style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span
            class="cm-keyword">new</span> <span class="cm-variable">Runnable</span>(){</span></pre></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span
            class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span
            class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span
            class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span
            class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span
            class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">10</span>; <span
            class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span
            class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span
            class="cm-variable">println</span>(<span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span
            class="cm-variable">getName</span>()<span class="cm-operator">+</span><span
            class="cm-string">"："</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                style="padding-right: 0.1px;">}).<span
            class="cm-variable">start</span>();</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 247px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 247px;"></div></div></div></pre>
    <h2><a name='header-n163' class='md-header-anchor '></a>13.3 Thread类</h2>
    <h3><a name='header-n164' class='md-header-anchor '></a>13.3.1 构造方法</h3>
    <ul>
        <li>public Thread() :分配一个新的线程对象。</li>
        <li>public Thread(String name) :分配一个指定名字的新的线程对象。</li>
        <li>public Thread(Runnable target) :分配一个带有指定目标新的线程对象。</li>
        <li>public Thread(Runnable target,String name) :分配一个带有指定目标新的线程对象并指定名字。</li>
    </ul>
    <h3><a name='header-n174' class='md-header-anchor '></a>13.3.2 线程使用基础方法</h3>
    <ul>
        <li><p>public void run() :此线程要执行的任务在此处定义代码。</p></li>
        <li><p>public String getName() :获取当前线程名称。</p></li>
        <li><p>public static Thread currentThread() :返回对当前正在执行的线程对象的引用。</p></li>
        <li><p>public final boolean isAlive()：测试线程是否处于活动状态。如果线程已经启动且尚未终止，则为活动状态。 </p></li>
        <li><p>public final int getPriority() ：返回线程优先级 </p></li>
        <li><p>public final void setPriority(int newPriority) ：改变线程的优先级</p>
            <ul>
                <li>每个线程都有一定的优先级，优先级高的线程将获得较多的执行机会。每个线程默认的优先级都与创建它的父线程具有相同的优先级。Thread类提供了setPriority(int
                    newPriority)和getPriority()方法类设置和获取线程的优先级，其中setPriority方法需要一个整数，并且范围在[1,10]之间，通常推荐设置Thread类的三个优先级常量：
                </li>
                <li>MAX_PRIORITY（10）：最高优先级</li>
                <li>MIN _PRIORITY （1）：最低优先级</li>
                <li>NORM_PRIORITY （5）：普通优先级，默认情况下main线程具有普通优先级。</li>
            </ul>
        </li>
    </ul>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div
            class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div
            style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea
            autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"
            style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div
            class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler"
                                                                                 cm-not-content="true"></div><div
            class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer"
                                                         style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div
            style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div
            role="presentation" style="position: relative; outline: none;"><div
            class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div
            style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div
            class="CodeMirror-activeline" style="position: relative;"><div
            class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div
            class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span
            class="cm-variable-3">void</span> <span class="cm-def">main</span>(<span class="cm-variable-3">String</span>[] <span
            class="cm-variable">args</span>) {</span></pre></div><pre class=" CodeMirror-line "
                                                                      role="presentation"><span role="presentation"
                                                                                                style="padding-right: 0.1px;"> &nbsp; &nbsp;<span
            class="cm-variable">Thread</span> <span class="cm-variable">t</span> <span
            class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(){</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span
            class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span
            class="cm-variable">run</span>(){</span></pre><pre class=" CodeMirror-line " role="presentation"><span
            role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span
            class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span
            class="cm-variable">println</span>(<span class="cm-variable">getName</span>() <span
            class="cm-operator">+</span> <span class="cm-string">"的优先级："</span> <span class="cm-operator">+</span> <span
            class="cm-variable">getPriority</span>());</span></pre><pre class=" CodeMirror-line "
                                                                        role="presentation"><span role="presentation"
                                                                                                  style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  };</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span
            class="cm-variable">t</span>.<span class="cm-variable">setPriority</span>(<span
            class="cm-variable">Thread</span>.<span class="cm-variable">MAX_PRIORITY</span>);</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span
            class="cm-variable">t</span>.<span class="cm-variable">start</span>();</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span
            cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                                                     style="padding-right: 0.1px;"> &nbsp; &nbsp;<span
            class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span
            class="cm-variable">println</span>(<span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span
            class="cm-variable">getName</span>() <span class="cm-operator">+</span><span
            class="cm-string">"的优先级："</span> <span class="cm-operator">+</span> <span class="cm-variable">Thread</span>.<span
            class="cm-variable">currentThread</span>().<span class="cm-variable">getPriority</span>());</span></pre><pre
            class=" CodeMirror-line " role="presentation"><span role="presentation"
                                                                style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div
            style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 321px;"></div><div
            class="CodeMirror-gutters" style="display: none; height: 321px;"></div></div></div></pre>
    <h3><a name='header-n198' class='md-header-anchor '></a>13.3.3 线程控制常见方法</h3>
    <ul>
        <li><p>public void start() :导致此线程开始执行; Java虚拟机调用此线程的run方法。</p></li>
        <li><p>public static void sleep(long millis) :线程睡眠，使当前正在执行的线程以指定的毫秒数暂停（暂时停止执行）。</p></li>
        <li><p>public static void
            yield()：线程礼让，yield只是让当前线程暂时失去执行权，让系统的线程调度器重新调度一次，希望优先级与当前线程相同或更高的其他线程能够获得执行机会，但是这个不能保证，完全有可能的情况是，当某个线程调用了yield方法暂停之后，线程调度器又将其调度出来重新执行。</p>
        </li>
        <li><p>void join() ：加入线程，当前线程中加入一个新线程，等待加入的线程终止后再继续执行当前线程。 </p>
            <p>void join(long millis) ：等待该线程终止的时间最长为 millis 毫秒。如果millis时间到，将不再等待。 </p>
            <p>void join(long millis, int nanos) ：等待该线程终止的时间最长为 millis 毫秒 + nanos 纳秒。 </p></li>
        <li><p>public final void stop()：强迫线程停止执行。 该方法具有不安全性，已被弃用，最好不要使用。</p>
            <ul>
                <li>调用 stop() 方法会立刻停止 run() 方法中剩余的全部工作，包括在 catch 或 finally
                    语句中的，并抛出ThreadDeath异常(通常情况下此异常不需要显示的捕获)，因此可能会导致一些清理性的工作的得不到完成，如文件，数据库等的关闭。
                </li>
                <li>调用 stop() 方法会立即释放该线程所持有的所有的锁，导致数据得不到同步，出现数据不一致的问题。</li>
            </ul>
        </li>
        <li><p>public void interrupt()：中断线程，实际上是给线程打上一个中断的标记，并不会真正使线程停止执行。</p></li>
        <li><p>public static boolean interrupted()：检查线程的中断状态，调用此方法会清除中断状态（标记）。</p></li>
        <li><p>public boolean isInterrupted()：检查线程中断状态，不会清除中断状态（标记）</p></li>
        <li><p>public void setDaemon(boolean
            on)：将线程设置为守护线程或用户线程。必须在线程启动之前设置，否则会报<code>IllegalThreadStateException</code>异常。</p>
            <ul>
                <li><strong>守护线程</strong>，主要为其他线程服务，当程序中没有非守护线程执行时，守护线程也将终止执行。JVM垃圾回收器也是守护线程。</li>
            </ul>
        </li>
        <li><p>public boolean isDaemon()：检查当前线程是否为守护线程。</p></li>
    </ul>
    <h4><a name='header-n230' class='md-header-anchor '></a>示例</h4>
    <ol start=''>
        <li><h4><a name='header-n233' class='md-header-anchor '></a>代码：倒计时</h4>
            <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false"
                 cid="n234" mdtype="fences">	public static void main(String[] args) {
		for (int i = 10; i&gt;=0; i--) {
			System.out.println(i);
			try {
				Thread.sleep(1000);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
		System.out.println("新年快乐！");
	}
</pre>
        </li>
        <li><h4><a name='header-n236' class='md-header-anchor '></a>示例代码：强行加塞</h4>
            <p>主线程：打印[1,10]，每隔10毫秒打印一个数字，</p>
            <p>自定义线程类：不停的问是否结束，输入Y或N，</p>
            <p>现在当主线程打印完5之后，就让自定义线程类加塞，直到自定义线程类结束，主线程再继续。</p>
            <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false"
                 cid="n240" mdtype="fences" style="break-inside: unset;">import java.util.Scanner;

public class TestJoin {
	public static void main(String[] args) {
		ChatThread t = new ChatThread();
		t.start();
		
		for (int i = 1; i &lt;= 10; i++) {
			System.out.println("main:" + i);
			try {
				Thread.sleep(10);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
         //当main打印到5之后，需要等join进来的线程停止后才会继续了。
			if(i==5){
				try {
					t.join();
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
			}
		}
	}
}
class ChatThread extends Thread{
	public void run(){
		Scanner input = new Scanner(System.in);
		while(true){
			System.out.println("是否结束？（Y、N）");
			char confirm = input.next().charAt(0);
			if(confirm == 'Y' || confirm == 'y'){
				break;
			}
		}
		input.close();
	}
}
</pre>
        </li>
        <li><h4><a name='header-n242' class='md-header-anchor '></a>示例代码：友谊赛</h4>
            <p>案例：编写龟兔赛跑多线程程序，设赛跑长度为30米</p>
            <p>兔子的速度是10米每秒，兔子每跑完10米休眠的时间10秒</p>
            <p>乌龟的速度是1米每秒，乌龟每跑完10米的休眠时间是1秒</p>
            <p>要求：要等兔子和乌龟的线程结束，主线程（裁判）才能公布最后的结果。</p>
            <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false"
                 cid="n247" mdtype="fences" style="break-inside: unset;">public class Racer extends Thread {
	private String name;//运动员名字
	private long runTime;//每米需要时间，单位毫秒
	private long restTime;//每10米的休息时间，单位毫秒
	private long distance;//全程距离，单位米
	private long totalTime;//跑完全程的总时间

	public Racer(String name, long distance, long runTime, long restTime) {
		super();
		this.name = name;
		this.distance = distance;
		this.runTime = runTime;
		this.restTime = restTime;
	}

	@Override
	public void run() {
		long sum = 0;
		long start = System.currentTimeMillis();
		while (sum &lt; distance) {
			System.out.println(name + "正在跑...");
			try {
				Thread.sleep(runTime);// 每米距离，该运动员需要的时间
			} catch (InterruptedException e) {
				return ;
			}
			sum++;
			try {
				if (sum % 10 == 0 &amp;&amp; sum &lt; distance) {
					// 每10米休息一下
					System.out.println(name+"已经跑了"+sum+"米正在休息....");
					Thread.sleep(restTime);
				}
			} catch (InterruptedException e) {
				return ;
			}
		}
		long end = System.currentTimeMillis();
		totalTime = end - start;
		System.out.println(name+"跑了"+sum+"米，已到达终点，共用时"+totalTime/1000.0+"秒");
	}

	public long getTotalTime() {
		return totalTime;
	}
}
</pre>
            <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false"
                 cid="n248" mdtype="fences" style="break-inside: unset;">public class TestJoin {
	public static void main(String[] args) {
		Racer rabbit = new Racer("兔子", 30, 100, 10000);
		Racer turtoise = new Racer("乌龟", 30, 1000, 1000);
		
		rabbit.start();
		turtoise.start();
		
        //因为要兔子和乌龟都跑完，才能公布结果
		try {
			rabbit.join();
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		try {
			turtoise.join();
		} catch (InterruptedException e) {
			e.printStackTrace();
		}		
		System.out.println("比赛结束");
        if(rabbit.getTotalTime()==turtoise.getTotalTime()){
            System.out.println("平局");
        }else if(rabbit.getTotalTime()&lt;turtoise.getTotalTime()){
            System.out.println("兔子赢");
        }else{
            System.out.println("乌龟赢");
        }
	}
}
</pre>
        </li>
        <li><h4><a name='header-n250' class='md-header-anchor '></a>示例代码：冠军赛</h4>
            <p>案例：编写龟兔赛跑多线程程序，设赛跑长度为30米</p>
            <p>兔子的速度是10米每秒，兔子每跑完10米休眠的时间10秒</p>
            <p>乌龟的速度是1米每秒，乌龟每跑完10米的休眠时间是1秒</p>
            <p>要求：只要兔子和乌龟中有人到达终点，就宣布比赛结束，没到达终点的也停下来。</p>
            <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false"
                 cid="n255" mdtype="fences" style="break-inside: unset;">public class Player extends Thread{
	private String name;//运动员名字
	private long runTime;//每米需要时间，单位毫秒
	private long restTime;//每10米的休息时间，单位毫秒
	private long distance;//全程距离，单位米
	private boolean flag = true;
	private volatile boolean ended = false;

	public Player(String name, long distance, long runTime, long restTime) {
		super();
		this.name = name;
		this.distance = distance;
		this.runTime = runTime;
		this.restTime = restTime;
	}

	@Override
	public void run() {
		long sum = 0;
		while (sum &lt; distance &amp;&amp; flag) {
			System.out.println(name + "正在跑...");
			try {
				Thread.sleep(runTime);// 每米距离，该运动员需要的时间
			} catch (InterruptedException e) {
				break ;
			}
			sum++;
			try {
				if (sum % 10 == 0 &amp;&amp; sum &lt; distance &amp;&amp; flag) {
					// 每10米休息一下
					System.out.println(name+"已经跑了"+sum+"米正在休息....");
					Thread.sleep(restTime);
				}
			} catch (InterruptedException e) {
				break ;
			}
		}
		ended = sum == distance ? true : false;
		System.out.println(name+"跑了"+sum+"米");
	}

	public void setFlag(boolean flag) {
		this.flag = flag;
	}

	public boolean isEnded() {
		return ended;
	}
	
}
</pre>
            <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false"
                 cid="n256" mdtype="fences" style="break-inside: unset;">public class TestStop {
	public static void main(String[] args) {
		Thread.currentThread().setPriority(Thread.MAX_PRIORITY);
		Player rabbit = new Player("兔子", 30, 100, 10000);
		Player turtoise = new Player("乌龟", 30, 1000, 1000);
		
		rabbit.start();
		turtoise.start();
		
		while(true){
			if(rabbit.isEnded() || turtoise.isEnded()){
				rabbit.setFlag(false);
				turtoise.setFlag(false);
				rabbit.interrupt();//中断休眠
				turtoise.interrupt();//中断休眠
				//只要有人跑完，就结束比赛，并公布结果
				break;
			}
		}
		
		System.out.println("比赛结束");
		if(rabbit.isEnded() &amp;&amp; turtoise.isEnded()){
			System.out.println("平局");
		}else if(rabbit.isEnded()){
			System.out.println("兔子赢");
		}else{
			System.out.println("乌龟赢");
		}
	}
}
</pre>
            <blockquote><p>
                volatile的作用是确保不会因编译器的优化而省略某些指令，volatile的变量是说这变量可能会被意想不到地改变，每次都小心地重新读取这个变量的值，而不是使用保存在寄存器里的备份，这样，编译器就不会去假设这个变量的值了。</p>
            </blockquote>
        </li>
        <li><h4><a name='header-n260' class='md-header-anchor '></a>守护线程</h4>
            <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false"
                 cid="n261" mdtype="fences" style="break-inside: unset;">public class TestThread {
	public static void main(String[] args) {
		MyDaemon m = new MyDaemon();
		m.setDaemon(true);
		m.start();

		for (int i = 1; i &lt;= 100; i++) {
			System.out.println("main:" + i);
		}
	}
}

class MyDaemon extends Thread {
	public void run() {
		while (true) {
			System.out.println("我一直守护者你...");
			try {
				Thread.sleep(1);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
	}
}
</pre>
            <p>&nbsp;</p></li>
    </ol>
    <h2><a name='header-n263' class='md-header-anchor '></a>13.4 线程生命周期</h2>
    <h3><a name='header-n264' class='md-header-anchor '></a>13.6.1 传统线程模型的五种线程状态</h3>
    <p>
        传统线程模型中把线程的生命周期描述为五种状态：<strong>新建（New）</strong>、<strong>就绪（Runnable）</strong>、<strong>运行（Running）</strong>、<strong>阻塞（Blocked）</strong>、<strong>死亡（Dead）</strong>。CPU需要在多条线程之间切换，于是线程状态会多次在运行、阻塞、就绪之间切换。
    </p>
    <p><img src='imgs13/1563282798989.png' alt='' referrerPolicy='no-referrer'/></p>
    <p><strong>1.</strong> <strong>新建</strong></p>
    <p>
        当一个Thread类或其子类的对象被声明并创建时，新生的线程对象处于新建状。此时它和其他Java对象一样，仅仅由JVM为其分配了内存，并初始化了实例变量的值。此时的线程对象并没有任何线程的动态特征，程序也不会执行它的线程体run()。</p>
    <p><strong>2.</strong> <strong>就绪</strong></p>
    <p>但是当线程对象调用了start()方法之后，线程就从新建状态转为就绪状态。这时线程并未执行，只是具备了运行的条件，还需要获取CPU资源后才能执行。</p>
    <p><strong>3.</strong> <strong>运行</strong></p>
    <p>
        如果处于就绪状态的线程获得了CPU资源，开始执行run()方法的线程体代码，则该线程处于运行状态。如果计算机只有一个CPU，在任何时刻只有一个线程处于运行状态，如果计算机有多个处理器，将会有多个线程并行(Parallel)执行。</p>
    <p>
        当然，美好的时光总是短暂的，而且CPU讲究雨露均沾。对于抢占式策略的系统而言，系统会给每个可执行的线程一个小时间段来处理任务，当该时间用完，系统会剥夺该线程所占用的资源，让其回到就绪状态等待下一次被调度。此时其他线程将获得执行机会，而在选择下一个线程时，系统会适当考虑线程的优先级。</p>
    <p><strong>4.</strong> <strong>阻塞</strong></p>
    <p>当在运行过程中的线程遇到某些特殊情况时，线程会临时放弃CPU资源，不再执行，即进入阻塞状态。比如：线程调用了sleep()方法，会主动放弃所占用的CPU资源。</p>
    <p><strong>5.</strong> <strong>死亡</strong></p>
    <p>线程完成任务结束或意外终止后，线程就处于死亡状态。</p>
    <h3><a name='header-n278' class='md-header-anchor '></a>13.6.2 JDK定义的六种线程状态（了解）</h3>
    <p>在<code>java.lang.Thread</code>类内部定义了一个枚举类用来描述线程的六种状态：</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n280"
         mdtype="fences">    public enum State {
        NEW,
        RUNNABLE,
        BLOCKED,
        WAITING,
        TIMED_WAITING,
        TERMINATED;
    }
</pre>
    <p>跟传统线程模型中的线程状态不同的是：</p>
    <ol start=''>
        <li><p>枚举类中没有区分<code>就绪</code>和<code>运行</code>状态，而是定义成了一种状态<code>Runnable</code>。</p>
            <ul>
                <li>因为对于Java对象来说，只能标记为可运行，至于什么时候运行，不是JVM来控制的了，是OS来进行调度的，而且时间非常短暂，因此对于Java对象的状态来说，无法区分。只能我们人为的进行想象和理解。
                </li>
            </ul>
        </li>
        <li><p>传统模型中的阻塞状态在枚举类的定义中又细分为了三种状态的：<code>BLOCKED</code>、<code>WAITING</code>、<code>TIMED_WAITING</code>。</p>
            <ul>
                <li><p><code>BLOCKED</code>：是指互有竞争关系的几个线程，其中一个线程占有锁对象时，其他线程只能等待锁。只有获得锁对象的线程才能有执行机会。</p></li>
                <li><p><code>TIMED_WAITING</code>：当前线程执行过程中遇到Thread类的sleep或join，Object类的wait，LockSupport类的park方法，并且在调用这些方法时，设置了时间，那么当前线程会进入TIMED_WAITING，直到时间到，或被中断。
                </p></li>
                <li><p><code>WAITING</code>：当前线程执行过程中遇到遇到Object类的wait，Thread类的join，LockSupport类的park方法，并且在调用这些方法时，没有指定时间，那么当前线程会进入WAITING状态，直到被唤醒。
                </p>
                    <ul>
                        <li>通过Object类的wait进入<code>WAITING</code>状态的要有Object的notify/notifyAll唤醒；</li>
                        <li>通过Condition的await进入<code>WAITING</code>状态的要有Conditon的signal方法唤醒；</li>
                        <li>通过LockSupport类的park方法进入<code>WAITING</code>状态的要有LockSupport类的unpark方法唤醒</li>
                        <li>通过Thread类的join进入<code>WAITING</code>状态，只有调用join方法的线程对象结束才能让当前线程恢复；</li>
                    </ul>
                </li>
            </ul>
            <p><em>说明：当从<code>WAITING</code>或<code>TIMED_WAITING</code>恢复到<code>Runnable</code>状态时，如果发现当前线程没有得到监视器锁，那么会立刻转入<code>BLOCKED</code>状态。</em>
            </p></li>
    </ol>
    <p><img src='imgs13/image-20200521184149034.png' alt='image-20200521184149034' referrerPolicy='no-referrer'/></p>
    <p>&nbsp;</p>
    <h2><a name='header-n309' class='md-header-anchor '></a>13.5 线程安全</h2>
    <p>当我们使用多个线程访问<strong>同一资源</strong>（可以是同一个变量、同一个文件、同一条记录等）的时候，但是如果多个线程中对资源有读和写的操作，就会出现前后数据不一致问题，这就是线程安全问题。</p>
    <p>案例：三个窗口售卖共100张火车票。</p>
    <h3><a name='header-n312' class='md-header-anchor '></a>13.5.1 线程安全问题引出</h3>
    <ol start=''>
        <li><h4><a name='header-n315' class='md-header-anchor '></a>局部变量不能共享</h4>
            <p>示例代码：</p>
            <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false"
                 cid="n317" mdtype="fences" style="break-inside: unset;">package com.atguigu.safe;

public class SaleTicketDemo1 {
	public static void main(String[] args) {
		Window w1 = new Window();
		Window w2 = new Window();
		Window w3 = new Window();
		
		w1.start();
		w2.start();
		w3.start();
	}
}
class Window extends Thread{
	public void run(){
		int total = 100;
		while(total&gt;0) {
			System.out.println(getName() + "卖出一张票，剩余:" + --total);
		}
	}
}
</pre>
            <p>结果：发现卖出300张票。</p>
            <p>问题：局部变量是每次调用方法都是独立的，那么每个线程的run()的total是独立的，不是共享数据。</p></li>
        <li><h4><a name='header-n321' class='md-header-anchor '></a>不同对象的实例变量不共享</h4>
            <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false"
                 cid="n322" mdtype="fences" style="break-inside: unset;">package com.atguigu.safe;

public class SaleTicketDemo2 {
	public static void main(String[] args) {
		TicketSaleThread t1 = new TicketSaleThread();
		TicketSaleThread t2 = new TicketSaleThread();
		TicketSaleThread t3 = new TicketSaleThread();
		
		t1.start();
		t2.start();
		t3.start();
	}
}
class TicketSaleThread extends Thread{
	private int total = 10;
	public void run(){
		while(total&gt;0) {
			System.out.println(getName() + "卖出一张票，剩余:" + --total);
		}
	}
}
</pre>
            <p>结果：发现卖出300张票。</p>
            <p>问题：不同的实例对象的实例变量是独立的。</p></li>
        <li><h4><a name='header-n326' class='md-header-anchor '></a>静态变量是共享的</h4>
            <p>示例代码：</p>
            <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false"
                 cid="n328" mdtype="fences" style="break-inside: unset;">package com.atguigu.safe;

public class SaleTicketDemo3 {
	public static void main(String[] args) {
		TicketThread t1 = new TicketThread();
		TicketThread t2 = new TicketThread();
		TicketThread t3 = new TicketThread();
		
		t1.start();
		t2.start();
		t3.start();
	}
}
class TicketThread extends Thread{
	private static int total = 10;
	public void run(){
		while(total&gt;0) {
			try {
				Thread.sleep(10);//加入这个，使得问题暴露的更明显
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
			System.out.println(getName() + "卖出一张票，剩余:" + --total);
		}
	}
}
</pre>
            <p>结果：发现卖出近100张票。</p>
            <p>问题（1）：但是有重复票或负数票问题。</p>
            <p>原因：线程安全问题</p>
            <p>问题（2）：如果要考虑有两场电影，各卖100张票，这场卖完就没票了，新的线程对象也没有票卖了</p>
            <p>原因：TicketThread类的静态变量，是所有TicketThread类的对象共享。本来成员变量就是run方法共享的数据，再用static不合适。</p></li>
        <li><h4><a name='header-n335' class='md-header-anchor '></a>同一个对象的实例变量共享</h4>
            <p>示例代码：多个Thread线程使用同一个Runnable对象</p>
            <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false"
                 cid="n337" mdtype="fences" style="break-inside: unset;">package com.atguigu.safe;

public class SaleTicketDemo3 {
	public static void main(String[] args) {
		TicketSaleRunnable tr = new TicketSaleRunnable();
		Thread t1 = new Thread(tr,"窗口一");
		Thread t2 = new Thread(tr,"窗口一");
		Thread t3 = new Thread(tr,"窗口一");
		
		t1.start();
		t2.start();
		t3.start();
	}
}
class TicketSaleRunnable implements Runnable{
	private int total = 10;
	public void run(){
		while(total&gt;0) {
			try {
				Thread.sleep(10);//加入这个，使得问题暴露的更明显
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
			System.out.println(Thread.currentThread().getName() + "卖出一张票，剩余:" + --total);
		}
	}
}
</pre>
            <p>结果：发现卖出近100张票。</p>
            <p>问题：但是有重复票或负数票问题。</p>
            <p>原因：线程安全问题</p></li>
    </ol>
    <h3><a name='header-n341' class='md-header-anchor '></a>13.5.2 线程安全问题原因分析</h3>
    <p>出现重复打印票和负数的问题分析（跟阻塞没关系）：</p>
    <p><img src="imgs13\售票案例线程安全问题分析.png" style="zoom:60%;"/></p>
    <p><strong>总结：线程安全问题的出现因为具备了以下条件</strong></p>
    <ol start=''>
        <li><strong>多线程执行</strong></li>
        <li><strong>共享数据</strong></li>
        <li><strong>多条语句操作共享数据</strong></li>
    </ol>
    <h3><a name='header-n352' class='md-header-anchor '></a>13.5.3 线程安全问题解决方式</h3>
    <p>上述线程安全问题的必备条件1和2是我们需要的，要解决只能从第三个点上想办法。要解决上述多线程并发访问一个资源的安全性问题:也就是解决重复票与不存在票问题，Java中提供了<strong>线程同步机制</strong>来解决。
    </p>
    <p><img src='imgs13/1563372934332.png' alt='1563372934332' referrerPolicy='no-referrer'/></p>
    <p>Java中常使用关键字<strong>synchronized</strong> 来实现同步机制：</p>
    <p><strong>同步方法</strong>：synchronized 关键字直接修饰方法，表示同一时刻只有一个线程能进入这个方法，其他线程在外面等着。</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n357"
         mdtype="fences">public&nbsp;synchronized&nbsp;void&nbsp;method(){
&nbsp;&nbsp;&nbsp; 可能会产生线程安全问题的代码
}
</pre>
    <p><strong>同步代码块</strong>：synchronized 关键字可以用于某个区块前面，表示只对这个区块的资源实行互斥访问。
        格式:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n359"
         mdtype="fences">synchronized(同步锁){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;需要同步操作的代码
}
</pre>
    <h3><a name='header-n360' class='md-header-anchor '></a>13.5.4 锁对象选择</h3>
    <p>同步锁对象：</p>
    <ul>
        <li>锁对象可以是任意类型。</li>
        <li>多个线程对象 要使用同一把锁。</li>
    </ul>
    <h4><a name='header-n367' class='md-header-anchor '></a>1、同步代码块的锁对象</h4>
    <ul>
        <li>静态方法中：使用当前类的Class对象</li>
        <li>非静态方法中：习惯上先考虑this，但是要注意是否同一个this</li>
    </ul>
    <p><strong>代码示例：</strong></p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n374"
         mdtype="fences" style="break-inside: unset;">//售票线程任务类
class SaleTicket implements Runnable {
    //票数
    private int count = 100;//共享资源

    @Override
    public void run() {
        while (true) {
			//同步代码块，this为锁对象
            synchronized (this) {
                if (count &gt; 0) {
                    System.out.println(Thread.currentThread().getName() + "--" + count);
                    count--;
                }
            }

        }
    }
}

//测试类
public class DemoSaleTicket {
    public static void main(String[] args) {
        //创建线程任务对象
        SaleTicket st = new SaleTicket(ticket);
		//创建售票线程对象，并启动线程
        new Thread(st).start();
        new Thread(st).start();

    }
}
</pre>
    <p><strong>代码改进：</strong></p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n376"
         mdtype="fences" style="break-inside: unset;">//售票线程任务类
class SaleTicket implements Runnable {
    private int count = 100;

    //售票线程任务
    @Override
    public void run() {
        while (true) {
            synchronized (this) {
                sell();//调用售票方法
            }

        }
    }
    //提取出售票方法
    private  void sell() {
        if (count &gt; 0) {
            System.out.println(Thread.currentThread().getName() + "--" + count);
            count--;
        }
    }
}


//测试类
public class DemoSaleTicket {
    public static void main(String[] args) {
        //创建线程任务对象
        SaleTicket st = new SaleTicket(ticket);
        //创建售票线程对象，并启动线程
        new Thread(st).start();
        new Thread(st).start();

    }
}
</pre>
    <p>&nbsp;</p><h4><a name='header-n378' class='md-header-anchor '></a>2、同步方法的锁对象</h4>
    <ul>
        <li>静态方法：当前类的Class对象</li>
        <li>非静态方法：this</li>
    </ul>
    <p><strong>示例代码：</strong></p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n385"
         mdtype="fences" style="break-inside: unset;">public class SaleTicket implements Runnable {
    private int count = 100;

    @Override
    public void run() {
        while (true) {
				//直接调用同步方法
                sell();
        }
    }
    //将售票方法改进为：同步方法，非静态的同步方法的锁对象默认为this
    private synchronized void sell() {
        if (count &gt; 0) {
            System.out.println(Thread.currentThread().getName() + "--" + count);
            count--;
        }
    }
}

</pre>
    <p><strong>示例改造：</strong></p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n387"
         mdtype="fences" style="break-inside: unset;">//共享资源类（将共享数据与同步方法封装到一个类中）
class Ticket {
    private int count=100;//票数

    //****同步方法，非静态同步方法的锁对象默认为this
    public synchronized void sell() {
        if (count &gt; 0) {
            System.out.println(Thread.currentThread().getName() + "--" + count--);
        }
    }
    
    public int getCount() {
        return count;
    }

}

//线程任务类
class SaleTicketRunnable implements Runnable {
    //共享的资源
    private Ticket ticket;
    //通过构造器传入共享资源
    public SaleTicketRunnable(Ticket ticket) {
        this.ticket = ticket;
    }
    //线程任务
    @Override
    public void run() {
        while (true) {
            //售票
            ticket.sell();
            if(ticket.getCount()&lt;=0)//售完跳出循环，结束线程任务
                break;
        }
    }

}
//测试类
public class DemoSaleTicket {
    public static void main(String[] args) {
        //创建共享资源
        Ticket ticket = new Ticket();
        //创建资源操作线程对象
        SaleTicket st = new SaleTicket(ticket);
        //创建售票线程对象，并启动线程
        new Thread(st).start();
        new Thread(st).start();

    }
}
</pre>
    <p>&nbsp;</p>
    <blockquote><p>锁的范围太小：不能解决安全问题，要同步所有操作共享资源的语句。</p>
        <p>锁的范围太大：因为一旦某个线程抢到锁，其他线程就只能等待，所以范围太大，效率会降低，不能合理利用CPU资源。</p></blockquote>
    <h3><a name='header-n392' class='md-header-anchor '></a>13.5.5 如何编写多线程的程序呢？</h3>
    <ul>
        <li><p>原则：</p>
            <ul>
                <li>线程操作资源类</li>
                <li>高内聚低耦合</li>
            </ul>
        </li>
        <li><p>步骤：</p>
            <ul>
                <li>编写资源类</li>
                <li>考虑线程安全问题，在资源类中考虑使用同步代码块或同步方法</li>
            </ul>
        </li>
    </ul>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n408"
         mdtype="fences" style="break-inside: unset;">public class TestSynchronized {
	public static void main(String[] args) {
		// 2、创建资源对象
		Ticket ticket = new Ticket();

		// 3、启动多个线程操作资源类的对象
		Thread t1 = new Thread("窗口一") {
			public void run() {
				while (true) {
					try {
						Thread.sleep(10);// 加入这个，使得问题暴露的更明显
						ticket.sale();
					} catch (Exception e) {
						e.printStackTrace();
						break;
					}
				}
			}
		};
		Thread t2 = new Thread("窗口二") {
			public void run() {
				while (true) {
					try {
						Thread.sleep(10);// 加入这个，使得问题暴露的更明显
						ticket.sale();
					} catch (Exception e) {
						e.printStackTrace();
						break;
					}
				}
			}
		};
		Thread t3 = new Thread(new Runnable() {
			public void run() {
				while (true) {
					try {
						Thread.sleep(10);// 加入这个，使得问题暴露的更明显
						ticket.sale();
					} catch (Exception e) {
						e.printStackTrace();
						break;
					}
				}
			}
		}, "窗口三");

		t1.start();
		t2.start();
		t3.start();
	}
}

// 1、编写资源类
class Ticket {
	private int total = 10;

	public synchronized void sale() {
		if(total&lt;=0){
			throw new RuntimeException(Thread.currentThread().getName() + "发现没有票了");
		}
		System.out.println(Thread.currentThread().getName() + "卖出一张票，剩余:" + --total);
	}
	public int getTotal() {
		return total;
	}
}
</pre>
    <h3><a name='header-n409' class='md-header-anchor '></a>13.5.6 单例设计模式的线程安全问题</h3><h4><a name='header-n410'
                                                                                            class='md-header-anchor '></a>1、饿汉式没有线程安全问题
    </h4>
    <p>饿汉式：上来就创建对象</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n412"
         mdtype="fences" style="break-inside: unset;">package com.atguigu.thread4;

public class OnlyOneDemo {
	public static void main(String[] args) {
		OnlyOne o1 = OnlyOne.INSTANCE;
		OnlyOne o2 = OnlyOne.INSTANCE;
		
		System.out.println(o1);
		System.out.println(o2);
		System.out.println(o1==o2);
	}
}
class OnlyOne{
	public static final OnlyOne INSTANCE = new OnlyOne();
	private OnlyOne(){
		
	}
}
</pre>
    <h4><a name='header-n413' class='md-header-anchor '></a>2、懒汉式线程安全问题</h4>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n414"
         mdtype="fences" style="break-inside: unset;">public class Singleton {
    private static Singleton ourInstance;

    public static Singleton getInstance() {
        //一旦创建了对象，之后再次获取对象，都不会再进入同步代码块，提升效率
        if (ourInstance == null) {
            //同步锁，锁住判断语句与创建对象并赋值的语句
            synchronized (Singleton.class) {
                if (ourInstance == null) {
                    ourInstance = new Singleton();
                }
            }
        }
        return ourInstance;
    }

    private Singleton() {
    }
}

</pre>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n416"
         mdtype="fences" style="break-inside: unset;">//测试类
public class Demo {
    public static void main(String[] args) {
        //开启多个线程获取单例
        new SingletonThread().start();
        new SingletonThread().start();
        new SingletonThread().start();

    }
}
//线程类
class SingletonThread extends Thread{
    @Override
    public void run() {
            Singleton instance = Singleton.getInstance();
            System.out.println(instance);//打印对象地址，查看每个线程获取的实例是否同一个
    }
}
</pre>
    <p>&nbsp;</p>
    <h2><a name='header-n418' class='md-header-anchor '></a>13.6 等待唤醒机制</h2>
    <h3><a name='header-n419' class='md-header-anchor '></a>13.6.1 线程间通信</h3>
    <p><strong>为什么要处理线程间通信：</strong></p>
    <p>多个线程在处理同一个资源，但是处理的动作（线程的任务）却不相同。而多个线程并发执行时, 在默认情况下CPU是随机切换线程的，当我们需要多个线程来共同完成一件任务，并且我们希望他们有规律的执行,
        那么多线程之间需要一些通信机制，可以协调它们的工作，以此来帮我们达到多线程共同操作一份数据。</p>
    <p>比如：线程A用来生成包子的，线程B用来吃包子的，包子可以理解为同一资源，线程A与线程B处理的动作，一个是生产，一个是消费，此时B线程必须等到A线程完成后才能执行，那么线程A与线程B之间就需要线程通信，即—— <strong>等待唤醒机制。</strong>
    </p>
    <h3><a name='header-n423' class='md-header-anchor '></a>13.6.2 等待唤醒机制</h3>
    <p><strong>什么是等待唤醒机制</strong></p>
    <p>这是多个线程间的一种<strong>协作</strong>机制。谈到线程我们经常想到的是线程间的<strong>竞争（race）</strong>，比如去争夺锁，但这并不是故事的全部，线程间也会有协作机制。</p>
    <p>就是在一个线程满足某个条件时，就进入等待状态（<strong>wait()</strong>/<strong>wait(time)</strong>）， 等待其他线程执行完他们的指定代码过后再将其唤醒（<strong>notify()</strong>）;或可以指定wait的时间，等时间到了自动唤醒；在有多个线程进行等待时，如果需要，可以使用
        notifyAll()来唤醒所有的等待线程。wait/notify 就是线程间的一种协作机制。</p>
    <ol start=''>
        <li>wait：线程不再活动，不再参与调度，进入 wait set 中，因此不会浪费 CPU 资源，也不会去竞争锁了，这时的线程状态即是
            WAITING或TIMED_WAITING。它还要等着别的线程执行一个<strong>特别的动作</strong>，也即是“<strong>通知（notify）</strong>”或者等待时间到，在这个对象上等待的线程从wait
            set 中释放出来，重新进入到调度队列（ready queue）中
        </li>
        <li>notify：则选取所通知对象的 wait set 中的一个线程释放；</li>
        <li>notifyAll：则释放所通知对象的 wait set 上的全部线程。</li>
    </ol>
    <blockquote><p>注意：</p>
        <p>被通知线程被唤醒后也不一定能立即恢复执行，因为它当初中断的地方是在同步块内，而此刻它已经不持有锁，所以她需要再次尝试去获取锁（很可能面临其它线程的竞争），成功后才能在当初调用 wait 方法之后的地方恢复执行。</p>
        <p>总结如下：</p>
        <ul>
            <li>如果能获取锁，线程就从 WAITING 状态变成 RUNNABLE（可运行） 状态；</li>
            <li>否则，线程就从 WAITING 状态又变成 BLOCKED（等待锁） 状态</li>
        </ul>
    </blockquote>
    <p><strong>调用wait和notify方法需要注意的细节</strong></p>
    <ol start=''>
        <li>wait方法与notify方法必须要由同一个锁对象调用。因为：对应的锁对象可以通过notify唤醒使用同一个锁对象调用的wait方法后的线程。</li>
        <li>wait方法与notify方法是属于Object类的方法的。因为：锁对象可以是任意对象，而任意对象的所属类都是继承了Object类的。</li>
        <li>wait方法与notify方法必须要在同步代码块或者是同步函数中使用。因为：必须要通过锁对象调用这2个方法。</li>
    </ol>
    <h3><a name='header-n451' class='md-header-anchor '></a>13.6.3 生产者与消费者问题</h3>
    <p>等待唤醒机制可以解决经典的“生产者与消费者”的问题。</p>
    <p>生产者与消费者问题（英语：Producer-consumer problem），也称有限缓冲问题（英语：Bounded-buffer
        problem），是一个多线程同步问题的经典案例。该问题描述了两个（多个）共享固定大小缓冲区的线程——即所谓的“生产者”和“消费者”——在实际运行时会发生的问题。生产者的主要作用是生成一定量的数据放到缓冲区中，然后重复此过程。与此同时，消费者也在缓冲区消耗这些数据。该问题的关键就是要保证生产者不会在缓冲区满时加入数据，消费者也不会在缓冲区中空时消耗数据。</p>
    <p>生产者与消费者问题中其实隐含了两个问题：</p>
    <ul>
        <li><p>线程安全问题：因为生产者与消费者共享数据缓冲区，不过这个问题可以使用同步解决。</p></li>
        <li><p>线程的协调工作问题：</p>
            <ul>
                <li>
                    要解决该问题，就必须让生产者线程在缓冲区满时等待(wait)，暂停进入阻塞状态，等到下次消费者消耗了缓冲区中的数据的时候，通知(notify)正在等待的线程恢复到就绪状态，重新开始往缓冲区添加数据。同样，也可以让消费者线程在缓冲区空时进入等待(wait)，暂停进入阻塞状态，等到生产者往缓冲区添加数据之后，再通知(notify)正在等待的线程恢复到就绪状态。通过这样的通信机制来解决此类问题。
                </li>
            </ul>
        </li>
    </ul>
    <h4><a name='header-n463' class='md-header-anchor '></a>一个厨师一个服务员问题</h4>
    <p>案例：有家餐馆的取餐口比较小，只能放10份快餐，厨师做完快餐放在取餐口的工作台上，服务员从这个工作台取出快餐给顾客。现在有1个厨师和1个服务员。</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n465"
         mdtype="fences" style="break-inside: unset;">package com.atguigu.thread5;

public class TestCommunicate {
	public static void main(String[] args) {
		// 1、创建资源类对象
		Workbench workbench = new Workbench();

		// 2、创建和启动厨师线程
		new Thread("厨师") {
			public void run() {
				while (true) {
					workbench.put();
				}
			}
		}.start();

		// 3、创建和启动服务员线程
		new Thread("服务员") {
			public void run() {

				while (true) {
					workbench.take();
				}
			}
		}.start();
	}

}

// 1、定义资源类
class Workbench {
	private static final int MAX_VALUE = 10;
	private int num;

	public synchronized void put() {
		if (num &gt;= MAX_VALUE) {
			try {
				this.wait();
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
		num++;
		System.out.println(Thread.currentThread().getName() + "制作了一份快餐，现在工作台上有：" + num + "份快餐");
		this.notify();
	}

	public synchronized void take() {
		if (num &lt;= 0) {
			try {
				this.wait();
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
		num--;
		System.out.println(Thread.currentThread().getName() + "取走了一份快餐，现在工作台上有：" + num + "份快餐");
		this.notify();
	}
}


</pre>
    <h4><a name='header-n466' class='md-header-anchor '></a>多个厨师多个服务员问题</h4>
    <p>案例：有家餐馆的取餐口比较小，只能放10份快餐，厨师做完快餐放在取餐口的工作台上，服务员从这个工作台取出快餐给顾客。现在有多个厨师和多个服务员。</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n468"
         mdtype="fences" style="break-inside: unset;">package com.atguigu.thread5;

public class TestCommunicate2 {
	public static void main(String[] args) {
		// 1、创建资源类对象
		WindowBoard windowBoard = new WindowBoard();

		// 2、创建和启动厨师线程
		// 3、创建和启动服务员线程
		Cook c1 = new Cook("张三",windowBoard);
		Cook c2 = new Cook("李四",windowBoard);
		Waiter w1 = new Waiter("小红",windowBoard);
		Waiter w2 = new Waiter("小绿",windowBoard);
		
		c1.start();
		c2.start();
		w1.start();
		w2.start();
	}

}
//1、定义资源类
class WindowBoard {
	private static final int MAX_VALUE = 10;
	private int num;

	public synchronized void put() {
		while (num &gt;= MAX_VALUE) {//必须循环判断。
			try {
				this.wait();//wait后会释放锁，Cooker1线程释放后，Cooker2线程获得锁（本应Waiter获得）进来后if继续wait，释放锁，Cooker1又快速获得锁，继续向下执行。。。
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
		num++;
		System.out.println(Thread.currentThread().getName() + "制作了一份快餐，现在工作台上有：" + num + "份快餐");
		this.notifyAll();
	}

	public synchronized void take() {
		while (num &lt;= 0) {
			try {
				this.wait();
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
		num--;
		System.out.println(Thread.currentThread().getName() + "取走了一份快餐，现在工作台上有：" + num + "份快餐");
		this.notifyAll();
	}
}


//2、定义厨师类
class Cook extends Thread{
	private WindowBoard windowBoard;
	
	public Cook(String name,WindowBoard windowBoard) {
		super(name);
		this.windowBoard = windowBoard;
	}

	public void run(){
		while(true) {
			windowBoard.put();
		}
	}
}


//3、定义服务员类
class Waiter extends Thread{
	private WindowBoard windowBoard;
	
	public Waiter(String name,WindowBoard windowBoard) {
		super(name);
		this.windowBoard = windowBoard;
	}

	public void run(){
		while(true) {
			windowBoard.take();
		}
	}
}

</pre>
    <h3><a name='header-n469' class='md-header-anchor '></a>练习</h3>
    <p>1、要求两个线程，同时打印字母，每个线程都能连续打印3个字母。两个线程交替打印，一个线程打印字母的小写形式，一个线程打印字母的大写形式，但是字母是连续的。当字母循环到z之后，回到a。</p>
    <p><img src='imgs13/线程安全练习2.png' alt='' referrerPolicy='no-referrer'/></p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n472"
         mdtype="fences" style="break-inside: unset;">package com.atguigu.thread7;

public class PrintLetterDemo {
	public static void main(String[] args) {
		// 2、创建资源对象
		PrintLetter p = new PrintLetter();

		// 3、创建两个线程打印
		new Thread("小写字母") {
			public void run() {
				while (true) {
					p.printLower();
					try {
						Thread.sleep(1000);// 控制节奏
					} catch (InterruptedException e) {
						e.printStackTrace();
					}
				}
			}
		}.start();

		new Thread("大写字母") {
			public void run() {
				while (true) {
					p.printUpper();
					try {
						Thread.sleep(1000);// 控制节奏
					} catch (InterruptedException e) {
						e.printStackTrace();
					}
				}
			}
		}.start();
	}
}

// 1、定义资源类
class PrintLetter {
	private char letter = 'a';

	public synchronized void printLower() {
		for (int i = 1; i &lt;= 3; i++) {
			System.out.println(Thread.currentThread().getName() + "-&gt;" + letter);
			letter++;
			if (letter &gt; 'z') {
				letter = 'a';
			}
		}
		this.notify();
		try {
			this.wait();
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
	}

	public synchronized void printUpper() {
		for (int i = 1; i &lt;= 3; i++) {
			System.out.println(Thread.currentThread().getName() + "-&gt;" + (char) (letter - 32));
			letter++;
			if (letter &gt; 'z') {
				letter = 'a';
			}
		}
		this.notify();
		try {
			this.wait();
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
	}
}
</pre>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <h2><a name='header-n475' class='md-header-anchor '></a>13.7 释放锁操作与死锁</h2>
    <p>任何线程进入同步代码块、同步方法之前，必须先获得对同步监视器的锁定，那么何时会释放对同步监视器的锁定呢？</p>
    <h3><a name='header-n477' class='md-header-anchor '></a><strong>1、释放锁的操作</strong></h3>
    <p>当前线程的同步方法、同步代码块执行结束。</p>
    <p>当前线程在同步代码块、同步方法中出现了未处理的Error或Exception，导致当前线程异常结束。</p>
    <p>当前线程在同步代码块、同步方法中执行了锁对象的wait()方法，当前线程被挂起，并释放锁。</p>
    <h3><a name='header-n481' class='md-header-anchor '></a><strong>2、不会释放锁的操作</strong></h3>
    <p>线程执行同步代码块或同步方法时，程序调用Thread.sleep()、Thread.yield()方法暂停当前线程的执行。</p>
    <p>线程执行同步代码块时，其他线程调用了该线程的suspend()方法将该该线程挂起，该线程不会释放锁（同步监视器）。应尽量避免使用suspend()和resume()这样的过时来控制线程。</p>
    <h3><a name='header-n484' class='md-header-anchor '></a>3、死锁</h3>
    <p>不同的线程分别锁住对方需要的同步监视器对象不释放，都在等待对方先放弃时就形成了线程的死锁。一旦出现死锁，整个程序既不会发生异常，也不会给出任何提示，只是所有线程处于阻塞状态，无法继续。</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n486"
         mdtype="fences" style="break-inside: unset;">public class TestDeadLock {
	public static void main(String[] args) {
		Object g = new Object();
		Object m = new Object();
		Owner s = new Owner(g,m);
		Customer c = new Customer(g,m);
		new Thread(s).start();
		new Thread(c).start();
	}
}
class Owner implements Runnable{
	private Object goods;
	private Object money;

	public Owner(Object goods, Object money) {
		super();
		this.goods = goods;
		this.money = money;
	}

	@Override
	public void run() {
		synchronized (goods) {
			System.out.println("先给钱");
			synchronized (money) {
				System.out.println("发货");
			}
		}
	}
}
class Customer implements Runnable{
	private Object goods;
	private Object money;

	public Customer(Object goods, Object money) {
		super();
		this.goods = goods;
		this.money = money;
	}

	@Override
	public void run() {
		synchronized (money) {
			System.out.println("先发货");
			synchronized (goods) {
				System.out.println("再给钱");
			}
		}
	}
}
</pre>
    <h3><a name='header-n487' class='md-header-anchor '></a>4、面试题：sleep()和wait()方法的区别</h3>
    <p>（1）sleep()不释放锁，wait()释放锁</p>
    <p>（2）sleep()指定休眠的时间，wait()可以指定时间也可以无限等待直到notify或notifyAll</p>
    <p>（3）sleep()在Thread类中声明的静态方法，wait方法在Object类中声明</p>
    <p>因为我们调用wait（）方法是由锁对象调用，而锁对象的类型是任意类型的对象。那么希望任意类型的对象都要有的方法，只能声明在Object类中。</p>
    <p>&nbsp;</p></div>

<figure>
    <table>
        <thead>
        <tr>
            <th style='text-align:right;'><a href='../javaSE.html'>回目录</a></th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td style='text-align:right;'>教程版本：1.2 更新日期：2019年1月3日</td>
        </tr>
        </tbody>
    </table>
</figure>
</body>
</html>